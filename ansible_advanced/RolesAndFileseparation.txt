File separation - includes
-----------
playbook.yml
inventory
|
-----inventory
 host_vars
 |
 ---- web1.yml
 ---web2.yml
 ---web3.yml
 group_vars
 |
  ---web_servers

Name the file with the same name as that of the host. (***important)

inventory
---------------
[web_servers]
web1
web2
web3

web1.yml
-------
ansible_host: 172.20.1.100

web2.yml
-------
ansible_host: 172.20.1.101

we3.yml
-------
ansible_host: 172.20.1.102

web_servers.yml
------------
dns_server: 10.1.1.5

include_vars
----------
- name: 
  hosts:
  tasks:
  - include_vars:
    file: /opt/apps/common-data/email/info.yml
    name: email_data

  - mail:
    to: {{email_data.admin_email}}
    subject:
    body:

/opt/apps/common-data/email/info.yml
admin_email: admin@company.com
---
The variables from the file will be loaded into the variable email_data
which can then be used in the form email_data.admin_email.

------
$ ansible-inventory -i inventory/ -y
all:
  children:
    ungrouped: {}
    web_servers:
      hosts:
        web1:
          ansible_hosts: 172.20.1.100
        web2:
          ansible_hosts: 172.20.1.101
------------
playbook.yml
---
- name: 
  hosts: web-db-server
  tasks:
  - name: install mysql package
  - name: start mysql service
  - name: configure database
  - name: install python flask
  - name: run web server
---
tasks/db.yml
  - name: install mysql package
  - name: start mysql service
  - name: configure database

tasks/web.yml
 - name: install python flask
 - name: run web server
-----
- name: 
  hosts: web-db-server
  tasks:
  - include_tasks: tasks/db.yml 
  - include_tasks: tasks/web.yml
------------

Let us continue to improve our lamp stack project. Now that we have learned to organize tasks into separate files, let's move the variables to it's respective files. Create a host_vars and group_vars directory and move all variables to them. No variables to be defined in the main inventory file. Only the below parameters are to be configured as host variables. All other parameters are to be configured as group variables for the respective groups:

Host Variables:

ansible_host

ansible_ssh_private_key_file

ansible_user


The inventory file is located at /home/thor/playbooks/lamp-stack-playbooks/inventory. You may edit its contents but not its filename or location.

[thor@ansible-controller lamp-stack-playbooks]$ cat inventory 
[db_servers]
lamp-db ansible_host=172.20.1.101 ansible_ssh_private_key_file=/home/thor/.ssh/maria ansible_user=maria mysqlservice=mysqld mysql_port=3306 dbname=ecomdb dbuser=ecomuser dbpassword=ecompassword

[web_servers]
lampweb ansible_host=172.20.1.100 ansible_ssh_private_key_file=/home/thor/.ssh/john ansible_user=john httpd_port=80 repository=https://github.com/kodekloudhub/learning-app-ecommerce.git

-----
Let's move the tasks to 3 separate files under the tasks directory. Create 3 files common.yml, db.yml and web.yml and move the associated tasks into each of them. Then include the tasks in the main playbook.


Do not modify the tasks or task names. Only move them to the respective files
---
TASK [include_tasks] ******************************************************************************************
fatal: [lampweb]: FAILED! => {"reason": "no action detected in task. This often indicates a misspelled module name, or incorrect module path.\n\nThe error appears to have been in '/home/thor/playbooks/lamp-stack-playbooks/tasks/common.yml': line 2, column 3, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n---\n- name: Deploy lamp stack application\n  ^ here\n"}
fatal: [lamp-db]: FAILED! => {"reason": "no action detected in task. This often indicates a misspelled module name, or incorrect module path.\n\nThe error appears to have been in '/home/thor/playbooks/lamp-stack-playbooks/tasks/common.yml': line 2, column 3, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n---\n- name: Deploy lamp stack application\n  ^ here\n"}



























